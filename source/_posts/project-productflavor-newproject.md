---
title: 工程通用能力-变体包衍生多个定制工程解决方案(java,res,lib全方位定制问题)
date: 2017-11-18 16:32:45
tags: [工程,观点]
categories: android技能
---
![image](http://7xjiyb.com1.z0.glb.clouddn.com/%E5%B7%A5%E7%A8%8B%E5%AE%9A%E5%88%B6%E9%97%AE%E9%A2%98%E5%8F%98%E4%BD%93%E5%8C%85%E7%9A%84%E9%97%AE%E9%A2%98.png?imageMogr2/crop/900x500)<!-- more -->
## 这个技术解决了什么问题 ## 
业务中遇到了一个问题需要定制一个版本给到另外的需求，但是主体的业务逻辑功能不用大动，需要定制的页面就是登录页面与所有的跟本软件相关的主体名称需要全部替换掉，颜色字体，启动页，升级包。  
本身想要的数据隔离，在后端的评估之后，被舍弃掉了，那么定制的工作都落到了客户端的头上。也算是一个比较好的成长时间，所以欣然接受吧。业务来倒逼输出也是不错的。如果业务需要客户端承担更大的优化与定制，对于个人的成长也是很不错的。哦，有点说教了，还是进入主题吧。  
从安卓的官方文档中也可以查阅到一些关于变体包的资料，[传送门之官方文档中国站传送门](https://developer.android.google.cn/studio/build/build-variants.html)  
当然如果只是官方文档的搬运，是不会有这篇文章的。  

## 适合在哪种场景使用 ## 
当有需要定制不同的字体(当然现在google可以通过下载字体进行替换),颜色值(也可以通过后台动态的进行切换)，各种启动页，各种登录页，各种主体提示与标志的定制。那么这些改动可能涉及到java源代码的定制，res中string，values，colors的定制，甚至是lib,so库的定制。那么被分支切换与升级合并冲突，每次的不同版本升级折腾的要死要死的你，可以考虑使用一下google的这套东西。

## 这个技术跟我已经掌握的哪个知识或技能类似，有什么差别、有什么特点、 有什么优点和缺点  ##
关于解决场景中的方法确实不少，条条大路通罗马，上面讲场景的时候，顺带就已经说过了。那么现在可以来说说优缺点吧
优点:
1.主体的逻辑可以通用
2.改动与共通的部分清晰好维护
缺点：
1.同样要承受一部分的定制之苦

## 上酸菜，咳咳，上代码例子 ## 
假设变体工程只有一个，但是相信我，开了这个定制的口子那么后面的事情就不止一个变体能解决的了，两个也不行。我们先讨论只有一个变体的情况：
![image](http://7xjiyb.com1.z0.glb.clouddn.com/%E5%8F%98%E4%BD%93%E9%85%8D%E7%BD%AE.png?imageMogr2/crop/900x500)
这个配置里，不止有例子该有的配置，还为你们打开了另一个大门，一个完整的公司级项目里面会涉及到的定制也包含在里面了。  
前面是签名的配置，这个不必多说，是为了下面的变体包不同的签名而存在的，包区分是不是同一个包，能不能被装在同一个手机上，就是通过报名和签名的不同来的，所以这两方面的定制必不可少。  
往下到productflavor的配置，产生的两个分支，这个名字可以任意复合groovy语言规则的名字都可以，新建之后需要在项目新建一个跟main同级的命名跟分支名相同的文件夹
![image](http://7xjiyb.com1.z0.glb.clouddn.com/%E5%8F%98%E4%BD%93%E5%8C%85-%E6%96%B0%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9.png?imageMogr2/crop/900x500)
文件夹下面新建需要的定制文件夹main文件夹下有的文件夹都可以新建也都可以定制。
![image](http://7xjiyb.com1.z0.glb.clouddn.com/%E5%8F%98%E4%BD%93%E6%96%B0%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9-%E5%AE%9A%E5%88%B6%E9%A2%84%E7%95%99%E6%96%87%E4%BB%B6%E5%A4%B9.png)  
那么我们先建这两个文件夹，新建的变体分支在buildvariants中可以进行动态的切换，我们现在在custom的分支下，所以custom的java是加载到编译器的，res是加载过的。
