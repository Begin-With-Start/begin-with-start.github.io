{"time":"0003","tplId":"QUICKPAY@cashier-card-no-recorrect-flex","publishVersion":"150924","tag":"QUICKPAY","name":"cashier-card-no-recorrect-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"script","children":[{"text":"(function(){var a=amc.fn.docConfig;amc.fn.docConfig=function(){var b=JSON.parse(a());b.navi={naviBarColor:\"#333333\",statusBarStyle:\"light\"};return JSON.stringify(b)}})();amc.fn.spmPageCreate(\"a283.b6308\");var getTag=amc.fn.getById;var rpc=amc.rpcData;var show=amc.fn.show;var hide=amc.fn.hide;var create=amc.fn.create;var gSegments=0;var gLastValueMap={};var gViewDidAppeared=false;var gScanflag=true;var ANIM_INTERVAL=200;var gIOSKeyBoardTimer=null;var INPUT_PREFIX=\"mqp_input_\";var LINE_PREFIX=\"mqp_line_\";var isResume=false;function init(){try{initUI();if(amc.fn.logPageInit){amc.fn.logPageInit(true)}amc.fn.spmExposure(\"a283.b6308.c13768.d25400\")}catch(a){if(amc.fn.logPageInit){amc.fn.logPageInit()}}}function initUI(){var a=amc.fn.navBack(true,\"{{confirm_card_no}}\",null,null,onBack,null,null);getTag(\"body\").insertBefore(a,getTag(\"recorrectArea\"));getTag(\"navImgL\").src=amc.res.navBackWhite;if(amc.isIOS){getTag(\"navTxtL\").style.color=\"#fff\"}getTag(\"navTxtM\").style.color=\"#fff\";if(amc.isAndroid){getTag(\"loading\").src=amc.path+\"alipay_msp_indicator_white_loading\"}var k=getTag(\"ocrImage\");k.src=rpc.ocrImage;var h=window.innerWidth-48;k.style.width=h;if(!rpc.ocrImageHeight||rpc.ocrImageHeight<=0||!rpc.ocrImageWidth||rpc.ocrImageWidth<=0||!rpc.ocrImage){amc.fn.logError(\"CARD_orc_image_err\",\"ocr image data error\");k.style.height=60}else{k.style.height=(rpc.ocrImageHeight*h)/rpc.ocrImageWidth}var l=getTag(\"inputContainer\");var c=rpc.ocrResult||\"\";var f=splitOcrCardNo(c);var e=window.innerWidth-48;var d=f.join(\"\");if(f.length>=6||f.length<=0||d.length>19){if(f.length>=6){amc.fn.logError(\"CARD_too_many_seg\",\"scan card with too much segment\")}else{if(f.length<=0){amc.fn.logError(\"CARD_result_empty\",\"scan card with empty result\")}else{if(d.length>19){amc.fn.logError(\"CARD_long_result\",\"scan card with long result\")}}}f=[d]}var j=calculateLRPadding(f.length-1);l.style.paddingLeft=j;l.style.paddingRight=j;var b=e-2*j-18*f.length;var g=calculateFontSize(b,f);for(var i=0;i<f.length;i+=1){appendInputBox(i,l,f[i],g)}gSegments=f.length;if(amc.isIOS){document.body.style.height=amc.specs.bodyHeight}else{document.body.style.height=window.innerHeight}setTimeout(function(){document.invoke(\"scanCard\",{type:\"kill\"},function(m){})},30)}function appendInputBox(a,c,h,g){g=Math.round(g*1.5);var b=create(\"div\",\"amc-v-box input-box\",c);if(h.length<=0){b.style.flex=1;getTag(\"submit\").disabled=true}else{b.style.flex=h.length}var f=create(\"div\",\"input-wrap-box\",b);f.style.height=(g+8)+\"px\";var d=create(\"input\",\"input-field\",f);d.type=amc.isIOS?\"apnumber\":\"number\";d.clear=\"disable\";d.value=h;d.style.cssText=\"font-size:\"+g+\"px\";d.id=INPUT_PREFIX+a;d.onfocus=function(){commonInputFocus(a)};d.oninput=function(){commonInputChange(a)};d.onkeydown=function(){onKeyDown(a)};d.onblur=function(){commonInputBlur(a)};gLastValueMap[d.id]=h;var e=create(\"div\",\"input-hight-line\",b);e.id=LINE_PREFIX+a}function commonInputBlur(a){getTag(LINE_PREFIX+a).style.backgroundColor=\"rgba(255, 255, 255, 0.6)\";if(amc.isIOS){var b=setTimeout(function(){if(gIOSKeyBoardTimer!==b){return}bodyFocusChange()},16);gIOSKeyBoardTimer=b}}var gFocusOnInput=false;function commonInputFocus(c){amc.fn.spmClick(\"a283.b6308.c13768.d25401\");getTag(LINE_PREFIX+c).style.backgroundColor=\"#108EE9\";gIOSKeyBoardTimer=null;if(gFocusOnInput){return}gFocusOnInput=true;var b=getTag(\"recorrectArea\");var a=getTag(\"bottomArea\");b.animation=[{type:\"translate\",fromValue:{x:0,y:0},toValue:{x:0,y:-63},duration:ANIM_INTERVAL}];a.animation=[{type:\"translate\",fromValue:{x:0,y:0},toValue:{x:0,y:-119},duration:ANIM_INTERVAL}];setTimeout(function(){if(!gFocusOnInput){return}doTranslateYAnimation(b,0,0,16);doTranslateYAnimation(a,0,0,16);b.style.paddingTop=\"0px\";b.style.paddingBottom=\"24px\"},ANIM_INTERVAL)}function bodyFocusChange(){if(!gFocusOnInput){return}gFocusOnInput=false;var b=getTag(\"recorrectArea\");var a=getTag(\"bottomArea\");b.style.paddingTop=\"63px\";b.style.paddingBottom=\"80px\";b.animation=[{type:\"translate\",fromValue:{x:0,y:-63},toValue:{x:0,y:0},duration:ANIM_INTERVAL}];a.animation=[{type:\"translate\",fromValue:{x:0,y:-119},toValue:{x:0,y:0},duration:ANIM_INTERVAL}]}function doTranslateYAnimation(b,d,c,a){b.animation=[{type:\"translate\",fromValue:{x:0,y:d},toValue:{x:0,y:c},duration:a}]}function commonInputChange(b){var a=getTag(INPUT_PREFIX+b);var d=a.value||\"\";if(d.match(\"^\\\\d*$\")){gLastValueMap[a.id]=d;gScanflag=false}else{a.value=gLastValueMap[a.id]}var c=collectCardNo();getTag(\"submit\").disabled=(!c)}function collectCardNo(){var b=[];for(var a=0;a<gSegments;a+=1){b.push(getTag(INPUT_PREFIX+a).value)}return b.join(\"\")}function splitOcrCardNo(d){var e=d.replace(new RegExp(\"[^\\\\d\\\\s]\",\"g\"),\"\");if(e.length!=d.length){amc.fn.logError(\"CARD_illegal_char\",\"scan card with illegal char\")}var c=e.split(\" \");var b=[];for(var a=0;a<c.length;a+=1){if(!c[a]){continue}b.push(c[a])}return b}var PADDING_TABLE=[24.75,19.5,14.75,10,5.25];function calculateLRPadding(a){return PADDING_TABLE[a]}function calculateFontSize(a){var b=a/19;return b>20?20:b}function onBack(){amc.fn.hideKeyboard();amc.fn.back()}function onSubmit(){var b={};b.action={name:rpc.nextAction||\"/card/verifyCardNo\",loadtxt:\"\",host:rpc.pci_url,https:true,enctype:\"application/x-www-form-urlencoded\",request_param:\"requestData\",params:rpc.params};var a=collectCardNo();b.param={cardno:a};if(gScanflag){b.param[\"scanflag\"]=true}document.asyncSubmit(b,function(d){if(d.pageloading===\"1\"){hide(\"btnText\");show(\"loading\")}else{if(d.pageloading===\"0\"){show(\"btnText\");hide(\"loading\")}else{if(d.status){var c=d.status.substr(2,2);if(c===\"02\"){getTag(INPUT_PREFIX+\"0\").focus()}}}}});document.invoke(\"scanCard\",{type:\"feedback\",cardNo:a},function(c){});amc.fn.spmClick(\"a283.b6308.c13768.d25400\")}function onKeyDown(a){if(event.which==\"keycode_confirm\"||event.which==10){if(amc.isIOS){amc.fn.hideKeyboard()}else{if(a&&amc.isAndroid){document.body.focus()}}}else{if(event.which==4){onBack()}}}document.viewDidAppear=function(){if(!gViewDidAppeared){gViewDidAppeared=true;if(amc.isAndroid){document.setProp(\"focusableInTouchMode\",{value:true})}document.body.focus()}if(isResume){amc.fn.spmExposureResume()}else{isResume=true}};","tag":"text"}]},{"tag":"style","children":[{"text":".amc-nav-container-android {\n            display: flex;\n            height: 48px;\n            flex-direction: column;\n        }\n\n        .amc-nav-box-android {\n            align-items: center;\n            display: flex;\n            flex: 1.0;\n            justify-content: center;\n            height: 47px;\n            background-color: #333\n        }\n\n        .amc-nav-r-box-android:active {\n            opacity: 0.4;\n        }\n\n        .amc-nav-l-img-box-android:active {\n            opacity: 0.4;\n        }\n\n        .amc-nav-horiz-line-android {\n            background-color: #333;\n            height: 1PX;\n        }\n\n        .loading-color {\n            color: #fff;\n        }\n\n        .input-recorrect-area {\n            padding-bottom: 80px;\n            padding-top: 63px;\n            padding-left: 24px;\n            padding-right: 24px;\n            background-color: #333;\n        }\n\n        .ocr-image {\n            min-height: 36px;\n            min-width: 150px;\n        }\n\n        .input-recorrect-box {\n            background-color: #1A1111;\n        }\n\n        .input-container {\n            margin-top: 30px;\n            margin-bottom: 11px;\n            height: 53.5px;\n        }\n\n        .input-box {\n            padding: 0px 8px;\n        }\n\n        .card-no-tip {\n            font-size: 14px;\n            padding: 1.5px 0px;\n            text-align: center;\n            margin-bottom: 30.5px;\n            opacity: 0.6;\n        }\n\n        .input-wrap-box {\n            align-items: center;\n            margin: 0px;\n            padding: 0px;\n        }\n\n        .input-field {\n            white-space: nowrap;\n            text-align: center;\n            color: #fff;\n            text-overflow: clip;\n            padding: 0px;\n            border: 0;\n            flex: 1.0;\n            overflow: hidden;\n            font-weight: bold;\n        }\n\n        .input-hight-line {\n            background-color: rgba(255, 255, 255, 0.6);\n            height: 1px;\n        }\n\n        .button-box {\n            padding: 0px 16px;\n            padding-top: 30px;\n            padding-bottom: 0px;\n            background-color: #fff;\n        }","tag":"text"}]}]},{"id":"body","onload":"init();","tag":"body","children":[{"id":"recorrectArea","tag":"div","children":[{"tag":"div","children":[{"id":"ocrImage","contentmode":"ScaleToFill","tag":"img","css":"ocr-image"}],"css":"amc-v-box"},{"tag":"div","children":[{"id":"inputContainer","tag":"div","css":"input-container amc-align-center"},{"id":"cardNoTip","tag":"label","children":[{"text":"{{card_no_recorrect_tip}}","tag":"text"}],"css":"card-no-tip amc-text-white-clolor"}],"css":"input-recorrect-box amc-v-box"}],"css":"amc-v-box input-recorrect-area"},{"id":"bottomArea","tag":"div","children":[{"id":"submit","tag":"div","children":[{"id":"loading","tag":"img","src":"indicatior","css":"amc-loading-img loading-color amc-hidden"},{"id":"btnText","tag":"label","children":[{"text":"{{next}}","tag":"text"}],"css":"amc-text-center amc-flex-1 amc-ellipsis amc-font-super amc-text-white-clolor"}],"onclick":"onSubmit();","css":"amc-btn-primary amc-justify-center amc-align-center"}],"css":"amc-v-box button-box amc-flex-1"},{"tag":"div","css":"amc-iphone-x-pd-b"}],"onfocus":"bodyFocusChange();","onkeydown":"onKeyDown();","implicitscroll":"disable","css":"amc-body amc-bg-white"}]},"format":"JSON","tplVersion":"5.3.8"}