{"data":{"children":[{"children":[{"src":"AlipaySDK.bundle/amc.i18n","tag":"meta","type":"i18n"},{"rel":"stylesheet","tag":"link","href":"AlipaySDK.bundle/amc.css"},{"src":"AlipaySDK.bundle/amc.js","tag":"script"},{"children":[{"tag":"text","text":"body,button,input,select,textarea {\n            font-family: \"PingFangSC-Regular\", \"Helvetica Neue\",Helvetica, STHeiTi ,sans-serif;\n            font-size: 14px;\n            color: #333333;\n        }\n\n        body {\n            background-color: #f5f5f5;\n        }\n\n        #mainBody {\n            overflow: scroll;;\n        }\n\n        .de-1px-line {\n            height: 1px;\n            background-color: #eeeeee;\n        }\n\n        .no-top-padding {\n            padding-top: 0;\n        }\n        .cell-box {\n            padding: 10px 15px;\n            min-height: 60px;\n        }\n        .flex-row {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n\n        .algin-item-start {\n            align-items: flex-start;\n        }\n\n        .flex-between {\n            justify-content: space-between;\n        }\n\n        .flex-justify-start {\n            justify-content: flex-start;\n        }\n\n        .checkbox-ios {\n            width: 15px;\n            height: 15px;\n            background-image: url(AlipaySDK.bundle/alipay_msp_check);\n            background-size: 15px 15px;\n        }\n\n        .checkbox-ios:checked {\n            background-image: url(AlipaySDK.bundle/alipay_msp_checked);\n        }\n\n        .checkbox-ios:disabled {\n            background-image: url(AlipaySDK.bundle/alipay_msp_check_disable);\n        }\n\n        .checkbox-android {\n            width: 15px;\n            height: 15px;\n            background-image: url(com.alipay.android.app/alipay_msp_check);\n            background-size: 17px 17px;\n        }\n\n        .checkbox-android:checked {\n            background-image: url(com.alipay.android.app/alipay_msp_checked);\n        }\n\n        .checkbox-android:disabled {\n            background-image: url(com.alipay.android.app/alipay_msp_check_disable);\n        }\n\n        .order-amount {\n            color: #f96268;\n        }\n\n        .merchant-logo {\n            height: 44px;\n            width: 44px;\n        }\n\n        .product-name {\n            flex: 1;\n            font-size: 17px;\n            margin-left: 16px;\n            margin-right: 8px;\n        }\n\n        .dialog-info-icon {\n            width: 16px;\n            height: 16px;\n        }\n\n        .de-product-desc {\n            color: #999999;\n            margin-top: 16px;\n        }\n\n        .deduct-label-list {\n            padding: 12px 16px;\n        }\n\n        .deduct-label-item {\n            padding: 4px 0;\n        }\n\n        .deduct-label {\n            flex: 1.0;\n            color: #999999;\n        }\n        .deduct-label-content {\n            flex: 2.0;\n            text-align: right;\n        }\n\n        .deduct-switch {\n            min-height: 44px;\n        }\n\n        .de-agreement-list {\n            display: flex;\n            align-items: flex-start;\n            padding: 16px 16px 0;\n        }\n\n        .de-agreement-checkbox {\n            width: 20px;\n            margin-right: 6px;\n            align-items: flex-start;\n        }\n        .de-agreement-links {\n            margin-left: 0;\n            margin-top: -5px;\n            font-size: 15px;\n            flex: 1;\n            line-height: 21px;\n            word-break: break-all;\n            word-wrap: break-word;\n            flex-wrap: wrap;\n        }\n\n        .link-text {\n            font-size: 14px;\n            color: #108ee9;\n        }\n\n        .de-info-dialog-item {\n            padding: 5px 15px;\n            display: flex;\n            justify-content: flex-start;\n            align-items: flex-start;\n        }\n\n        .de-dialog-prefix {\n            flex: 1;\n            line-height: 1;\n            align-self: flex-start;\n        }\n\n\n        .de-dialog-content {\n            flex: 10;\n            word-break: break-all;\n            word-wrap: break-word;\n        }\n\n        .dlg-btn {\n            text-align: center;\n            padding:15px;\n            border: 1px solid #e5e5e5;\n            width: 100%;\n            color: #108ee9;\n        }\n\n        .dlg-btn-text {\n            color: #108ee9;\n            text-align: center;\n        }\n\n        .btn-primary-wrapper {\n            margin: 0 15px;\n            background-color:#108ee9;\n            border: 0;\n            border-radius: 5px;\n            color:#fff;\n            font-size:18px;\n            height: 42px;\n            max-height: 42px;\n            min-height: 42px;\n            flex: 1.0;\n        }\n\n        .btn-primary {\n            background-color:#108ee9;\n            border: 0;\n            border-radius: 5px;\n            color:#fff;\n            font-size:18px;\n            height: 42px;\n            max-height: 42px;\n            min-height: 42px;\n            flex: 1.0;\n        }\n\n        .de-dialog-prefix-logo {\n            height: 6px;\n            width: 6px;\n            border-radius: 3px;\n            background-color: #333;\n            align-self: flex-start;\n            margin-right: 5px;\n            margin-top: 5px;\n        }\n\n        .de-toast {\n            position: absolute;\n            top: 300px;\n            left: 70px;\n            right: 70px;\n            height: auto;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n\n        .de-toast-label {\n            flex: 1;\n            text-align: center;\n            color: #fff;\n            padding: 5px 15px;\n            border-radius: 4px;\n            opacity: 0.7;\n            background-color: #333;\n        }"}],"tag":"style"},{"children":[{"tag":"text","text":"amc.fn.spmPageCreate(\"a259.b13454\");var logError=function(a,c){try{console.info(\"==> start error log \"+a);amc.fn.logError(a,c)}catch(b){amc.fn.logError(\"log_error_failed\",\"\")}};if(amc.isFlybird){console={};console.log=print;console.info=print;console.error=logError}var rpcData=amc.rpcData;var getTag=amc.fn.getById;var exit=amc.fn.exit;var show=amc.fn.show;var hide=amc.fn.hide;var create=amc.fn.create;var toastTimeoutRef=null;var pageData={initPageToken:rpcData.initPageToken};var agreeCheckboxId=\"de-agree-checkbox\";var deductSwitchId=\"deduct-switch\";var deInfoDialogId=\"de-info-dialog\";var MAX_PAY_QUOTA=99999999;var deductAgreementCheckbox=getTag(\"de-agree-checkbox\");deductAgreementCheckbox.className=amc.isIOS?\"checkbox-ios\":\"checkbox-android\";function toast(c,a,b){if(!c){return}if(amc.isAndroid){if(b&&gToastDisabled){return}else{setTimeout(function(){gToastDisabled=false},2000);gToastDisabled=true}}document.toast({text:c,type:a||\"none\"},function(){})}function init(){try{initUI();if(amc.fn.logPageInit){amc.fn.logPageInit(true)}}catch(a){console.error(\"catch\",\"进入了异常流程\");if(amc.fn.logPageInit){amc.fn.logPageInit()}}}function initUI(){var c=rpcData;var b=rpcData;var d=amc.fn.getNav(amc.res.navBack,\"{{return}}\",c.pageTitle,null,null,onBack,null);getTag(\"body\").insertBefore(d,getTag(\"mainBody\"));getTag(\"mainBody\").style.height=amc.specs.bodyHeight;if(amc.isAndroid){getTag(\"loading\").src=amc.path+\"alipay_msp_indicator_white_loading\"}var a=getTag(\"mainBody\");renderDeductMerchant(c.merchantDetailInfo);renderDeductLabelsDom(c.deductPageLabelInfos);renderDialogInfo(c.merchantDetailInfo);renderAgreementInfo(c.deductAgreementDetailInfos);show(a);console.log(\"==> render done\")}function postRPC(b,c,d,e){if(!b){return}var a={operationType:b,requestData:c};setTimeout(function(){document.invoke(\"rpc\",a||{},function(f){f=f||{};if(isRpcSuccess(f)){d&&d(f)}else{logError(b,f);commonErrorForPostRPC(f);e&&e(f)}})},10)}function commonErrorForPostRPC(a){a=a||{};if(a.errorMsg){}else{if(a.error==\"10\"||a.error==\"11\"){toast(\"网络不给力\",\"fail\")}else{if(a.error){toast(\"网络开小差，请稍后重试\")}}}}function isRpcSuccess(a){return a&&(a.success||a.resultCode===\"SUCCESS\"||a.resultCode===\"success\")}function showToast(b){var c=getTag(\"de-toast\");var a=getTag(\"de-toast-label\");a.innerText=b;if(toastTimeoutRef){clearTimeout(toastTimeoutRef)}show(c);toastTimeoutRef=setTimeout(function(){hide(c);a.innerText=\"\"},3000)}function gotoLink(a,b){document.submit({action:{name:\"loc:openweb('\"+a+\"','\"+b+\"')\"}})}function showInfoDialog(){getTag(deInfoDialogId).showModal()}function hideInfoDialog(){getTag(deInfoDialogId).close()}function renderDeductMerchant(b){var c=getTag(\"merchant-logo\");var a=getTag(\"de-product-name\");var e=getTag(\"de-product-desc\");var d=b.merchantLogoUrl||\"\";d=d.replace(/\\[pixelWidth\\]x\\[pixelHeight\\]/g,\"60x60\");c.src=d;a.innerText=b.merchantProductName;e.innerText=b.serviceDescription}function renderDialogInfo(i){var b=getTag(deInfoDialogId);var g=getTag(\"de-info-dialog-title\");var e=getTag(\"de-info-dialog-content\");if(!i){return}g.innerText=i.deductProdName;if(i.singlePayQuota<MAX_PAY_QUOTA&&i.singleDayQuota<MAX_PAY_QUOTA){var d=\"单笔扣款限额\"+i.singlePayQuota+\"元，每日累计限额\"+i.singleDayQuota+\"元\";createSingleDialogItem(d,e)}if(i.deductConfirmAmount){var c=\"单笔金额高于\"+i.deductConfirmAmount+\"元时，需要你短信确认才会扣款\";createSingleDialogItem(c,e)}if(i.deductSupportTools){var f=\"扣款渠道：\"+i.deductSupportTools;createSingleDialogItem(f,e)}var a=\"扣款顺序：请查看『支付宝』—『我的』—『设置』—『支付设置』—『扣款顺序』\";createSingleDialogItem(a,e);if(i.invalidTime){var h=\"有效期至: \"+i.invalidTime;createSingleDialogItem(h,e)}}function createSingleDialogItem(b,e){var d=create(\"div\",\"de-info-dialog-item\",e);var c=create(\"div\",\"de-dialog-prefix-logo\",d);var a=create(\"label\",\"de-dialog-content\",d);a.innerText=b}function renderDeductLabelsDom(b){if(!b||b.length<1){return}var c=getTag(\"deduct-label-list\");for(var a=0;a<b.length;a++){createSingleDeductLabel(b[a],c)}}function createSingleDeductLabel(e,c){if(!c){return}var a=create(\"div\",\"flex-row flex-between algin-item-start deduct-label-item\",c);var b=create(\"label\",\"deduct-label\",a);b.innerText=e.labelName||\"\";var d=create(\"label\",\"deduct-label-content\",a);d.innerText=e.labelValue||\"\"}function renderAgreementInfo(f){var a=\"确认开通\";var h=\"同意协议并开通\";var d=getTag(\"de-agreement-links\");var c=getTag(\"de-agreement-confirm-checkbox\");var b=getTag(\"submit-btn\");var g=\"\";if(!f||f.length<1){c.innerText=\"\";return}var l=function(m){var o=\"支付宝\";for(var n=0;n<f.length;n++){var p=f[n];if(p.agreementUrl===m){agreementName=p.agreementName;break}}gotoLink(m,agreementName)};if(f.length>1){show(c);g+='<a color=\"#8b8b8b\" href=\"toggle_check\">我已阅读并同意</a>';b.innerText=a}else{c.innerHTML=\"\";g+='<font color=\"#000000\" >查看</font>';b.innerText=h}for(var e=0;e<f.length;e++){var k=f[e];var j='<a color=\"#108ee9\" href=\"'+k.agreementUrl+'\">'+k.agreementName+\"</a>\";g+=j}getTag(\"de-agreement-links\").innerText=g;getTag(\"de-agreement-links\").onlink=function(i){console.log(i);if(!i){return}if(i===\"toggle_check\"){toggleAgreeCheckbox();return}amc.fn.spmClick(\"a259.b13454.c32640.d64637\");l(i)}}function toggleAgreeCheckbox(){amc.fn.spmClick(\"a259.b13454.c32640.d64636\");var a=getTag(agreeCheckboxId);a.checked=!a.checked}function errorToast(a){showToast(a||\"\");enableSubmitBtn()}function errorCallback(a){console.log(\"签约失败\");document.invoke(\"setResult\",a,function(b){console.log(\"setResult失败\")});exit()}function successCallback(a){console.log(\"签约成功\");document.invoke(\"setResult\",a,function(b){console.log(\"setResult成功\")});exit()}function applySign(){var b=function(c){if(!!c.agreementNo){console.log(\"幂等返回:\"+c.agreementNo);successCallback(c);return}pageData.applyToken=c.applyToken;pageData.verifyId=c.verifyId;pageData.securityId=c.securityId;pageData.agreementNo=c.agreementNo;verifyIdendity()};var a=function(c){console.log(\"apply error\");if(c.errorCode===\"USER_AGREEMENT_PERIOD_CONFILICT\"){errorCallback(c)}else{if(c.errorMsg){errorToast(c.errorMsg)}enableSubmitBtn()}};postRPC(\"alipay.mdeduct.sdk.sign.apply\",{initPageToken:pageData.initPageToken},b,a)}function verifyIdendity(){document.invoke(\"verifyIdentity\",{verifyId:pageData.verifyId},function(a){console.log(a.code);console.log(a.verifyId);if(a.code===\"1000\"){confirmSign()}else{console.error(\"核身失败\",a.code);logError(\"IDENDITY_VERIFY_FAILED\",a.code||\"\");enableSubmitBtn()}})}function confirmSign(){var b=function(c){console.log(\"签约成功\");console.log(\"签约完成，签约协议号:\"+c.agreementNo);console.log(\"pid:\"+c.partnerId);successCallback(c)};var a=function(c){console.log(\"签约失败\");errorCallback(c)};postRPC(\"alipay.mdeduct.sdk.sign.confirm\",{applyToken:pageData.applyToken,securityId:pageData.securityId},b,a)}function disableSubmitBtn(){amc.fn.shouldShowBtnIndicator({pageloading:\"1\"},\"submit-btn\",\"loading\")}function enableSubmitBtn(){amc.fn.shouldShowBtnIndicator({pageloading:\"0\"},\"submit-btn\",\"loading\")}function submitInfo(){amc.fn.spmClick(\"a259.b13454.c32640.d64635\");var b=getTag(deductSwitchId);var a=getTag(agreeCheckboxId);if(a&&!a.checked){showToast(\"请先阅读并同意协议\");return}disableSubmitBtn();applySign()}function onBack(){amc.fn.spmClick(\"a259.b13454.c32478.d64255\");var a={title:\"\",message:\"{{confirm_exit}}\",okButton:\"{{confirm_btn}}\",cancelButton:\"{{cancel}}\"};amc.fn.spmExposure(\"a259.b13454.c32629\");document.confirm(a,function(b){if(b.ok){amc.fn.spmClick(\"a259.b13454.c32629.d64618\");amc.fn.spmPageDestroy(\"a259.b13454\");errorCallback({cancel:true})}else{amc.fn.spmClick(\"a259.b13454.c32629.d64619\")}})}function onKeyDown(){if(event.which==4){onBack()}};"}],"tag":"script"}],"tag":"head"},{"css":"amc-body","children":[{},{"css":"amc-main amc-hidden no-top-padding","children":[{"css":"amc-main amc-margin-b-s no-top-padding","children":[{"css":"amc-v-box amc-bg-white amc-pd","children":[{"css":"flex-row flex-justify-start","children":[{"css":"merchant-logo","tag":"img","id":"merchant-logo"},{"css":"product-name ","tag":"label","id":"de-product-name"},{"css":"dialog-info-icon","src":"AlipaySDK.bundle/alipay_msp_info","contentmode":"ScaleAspectFill","onclick":"showInfoDialog();","tag":"img"}],"tag":"div"},{"css":"de-product-desc","tag":"label","id":"de-product-desc"}],"tag":"div"},{"css":"amc-1px-line","tag":"div"},{"css":"deduct-label-list amc-v-box amc-bg-white","tag":"div","id":"deduct-label-list"},{"css":"de-1px-line","tag":"div"},{"css":"amc-abs-space-v-m","tag":"div"},{"css":"de-agreement-list","children":[{"css":"de-agreement-checkbox amc-hidden","children":[{"css":"amc-checkbox amc-margin-r-xs","onclick":"toggleAgreeCheckbox();","tag":"input","id":"de-agree-checkbox","type":"checkbox"}],"tag":"div","id":"de-agreement-confirm-checkbox"},{"css":"de-agreement-links","tag":"label","id":"de-agreement-links"}],"tag":"div","id":"de-agreement-list"},{"css":"amc-abs-space-v-m","tag":"div"},{"css":"amc-abs-space-v-m","tag":"div"},{},{"css":"btn-primary-wrapper amc-align-center amc-justify-center","children":[{"css":"amc-loading-img amc-text-white-clolor amc-hidden","src":"indicatior","tag":"img","id":"loading"},{"css":"btn-primary","children":[{"tag":"text","text":"确认开通"}],"onclick":"submitInfo();","tag":"button","id":"submit-btn"}],"tag":"div"}],"tag":"div"}],"tag":"div","id":"mainBody"},{"css":"de-toast amc-hidden","children":[{"css":"de-toast-label","tag":"label","id":"de-toast-label"}],"tag":"div","id":"de-toast"},{"css":"amc-dlg-box amc-v-box","children":[{"css":"","children":[{"css":"amc-flex-1 amc-dlg-title","tag":"label","id":"de-info-dialog-title"}],"tag":"div"},{"css":"amc-v-box amc-dlg-width","tag":"div","id":"de-info-dialog-content"},{"css":"custom-line","tag":"div"},{"css":"amc-1px-line amc-flex-1","tag":"div"},{"css":"amc-flex-1 amc-margin-t dlg-btn amc-font-m amc-align-center","children":[{"tag":"text","text":"我知道了"}],"onclick":"hideInfoDialog();","tag":"label"}],"tag":"dialog","id":"de-info-dialog"}],"tag":"body","id":"body","onkeydown":"onKeyDown();","onload":"init();"}],"tag":"html"},"publishVersion":"150924","name":"mdeduct-sign-flex","format":"JSON","tag":"QUICKPAY","time":"0008","tplId":"QUICKPAY@mdeduct-sign-flex","tplVersion":"5.2.9"}