{"time":"0002","tplId":"QUICKPAY@card-detail-flex","publishVersion":"150924","tag":"QUICKPAY","name":"card-detail-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"script","src":"card-detail-flex.js"},{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","children":[{"text":"var getTag=amc.fn.getById;var rpc=amc.rpcData;var show=amc.fn.show;var hide=amc.fn.hide;var path=amc.path+\"alipay_msp_\";var infoPng=path+\"info\";var infoPngOrange=path+\"info_orange.png\";var needInput=rpc.needinput;var userName=needInput.username;var certNo=needInput.certno;var certType=needInput.certtype;var bankMobile=needInput.bankmobile;var userNameDisplay=userName&&userName.display;var certNoDisplay=certNo&&certNo.display;var certTypeDisplay=certNoDisplay&&certType&&certType.display;var bankMobileDisplay=bankMobile&&bankMobile.display;var userNameDefault=(userName&&userName.value)?userName.value:\"\";var certNoDefault=(certNo&&certNo.value)?certNo.value:\"\";var certTypeDefault=(certType&&certType[\"default\"])?certType[\"default\"]:\"\";var bankMobileDefault=(bankMobile&&bankMobile.value)?bankMobile.value:\"\";var certTypeTextArray=new Array();var certTypeValueArray=new Array();var useOrange=(rpc.color===\"orange\");var currentIndex=0;var isFirstInput={};var defaultValues={certNo:certNoDefault,bankMobile:bankMobileDefault};function init(){try{initUI();if(amc.fn.logPageInit){amc.fn.logPageInit(true)}}catch(a){if(amc.fn.logPageInit){amc.fn.logPageInit()}}}function initUI(){var d=amc.fn.getNav(amc.res.navBack,\"返回\",\"填写银行卡信息\",null,null,onBack,null);getTag(\"body\").insertBefore(d,getTag(\"mainBody\"));if(useOrange){getTag(\"submit\").className=\"btn-orange\";getTag(\"btnBox\").className=\"btn-orange amc-justify-center amc-align-center\";getTag(\"protocol\").style.color=\"#000\";getTag(\"certType\").style.color=\"#ff5500\";getTag(\"cvvInfo\").src=infoPngOrange;getTag(\"validateInfo\").src=infoPngOrange;getTag(\"phoneInfo\").src=infoPngOrange}else{getTag(\"cvvInfo\").src=infoPng;getTag(\"validateInfo\").src=infoPng;getTag(\"phoneInfo\").src=infoPng}if(amc.isAndroid){getTag(\"loading\").src=amc.path+\"alipay_msp_indicator_white_loading\"}if(rpc.bankname){getTag(\"bankName\").innerText=rpc.bankname||\"\";getTag(\"cardType\").innerText=rpc.isCredit?\"信用卡\":\"储蓄卡\"}else{hide(\"cardNameArea\")}if(!rpc.cvv2){hide(\"cvvArea\");getTag(\"cvv2\").disabled=true;if(!rpc.validate){hide(\"cvv2AndValidate\");getTag(\"validate\").disabled=true}else{hide(\"cvv2AndValidateLine\")}}else{if(!rpc.validate){hide(\"cvv2AndValidateLine\");hide(\"validateArea\");getTag(\"validate\").disabled=true}}if(userNameDisplay){var b=getTag(\"userName\");b.value=userNameDefault;b.disabled=!!userName.disable}else{hide(\"userNameArea\");getTag(\"userName\").disabled=true;hide(\"nameAndCertNoLine\")}if(certNoDisplay){var a=getTag(\"certNo\");a.value=certNoDefault;a.disabled=!!certNo.disable}else{hide(\"certNoArea\");getTag(\"certNo\").disabled=true;hide(\"nameAndCertNoLine\")}if(!userNameDisplay&&!certNoDisplay){hide(\"nameAndCertNo\")}if(bankMobileDisplay){var c=getTag(\"bankMobile\");c.value=bankMobileDefault;c.disabled=!!bankMobile.disable}else{hide(\"bankMobileArea\");getTag(\"bankMobile\").disabled=true}initCertTypePicker();updateInputState(\"cvv2\",\"cvvInfoBox\");updateInputState(\"validate\",\"validateInfoBox\");updateInputState(\"bankMobile\",\"bankMobileInfoBox\");updateSubmitState()}function initCertTypePicker(){if(!certTypeDisplay){return}if(getTag(\"certNo\").disabled||certType.disable){getTag(\"certType\").style.color=\"#a5a5a5\"}var c=certType.value;if(c){for(var d in c){var b=c[d];certTypeTextArray.push(d);certTypeValueArray.push(b);if(b===needInput.certtype[\"default\"]){currentIndex=certTypeTextArray.length-1}}var a=certTypeTextArray[currentIndex];if(a){getTag(\"certNo\").placeholder=\"请输入\"+a+\"号码\";getTag(\"certType\").innerText=a}}else{getTag(\"certNo\").placeholder=\"请输入身份证号码\"}show(\"certTypeArea\")}function onClickCertType(){if(getTag(\"certNo\").disabled){return}var a={btns:certTypeTextArray,\"default\":currentIndex,title:\"选择证件号\"};document.picker(a,function(c){var b=c.index;if(b!==undefined&&currentIndex!==b){currentIndex=b;getTag(\"certNo\").value=\"\";getTag(\"certType\").innerText=certTypeTextArray[b];getTag(\"certNo\").placeholder=\"请输入\"+(certTypeTextArray[b]||\"\")+\"号码\";updateSubmitState()}})}function showProtocol(){amc.fn.showProtocolList(rpc.protocols)}var inputVerify={};inputVerify.cvv2={regex:\"^\\\\d{0,4}$\",lastValue:\"\"};inputVerify.validate={regex:\"^\\\\d{2}/\\\\d{2}$\",lastValue:\"\"};inputVerify.bankMobile={regex:\"^[0-9-+]*$\",lastValue:\"\"};inputVerify.certNo={regex:\"(^\\\\d{0,18}$)|(^\\\\d{17}([X|x]{0,1}))$\",lastValue:\"\"};function getFirtDifferent(c,b){c=c||\"\";b=b||\"\";var a=0;while(a<b.length){if(a>=c.length||c[a]!==b[a]){return b[a]}a++}return\"\"}function toast(b,a){if(!getTag(a)||!b){return}document.toast({text:b,type:\"fail\"},function(){getTag(a).focus()})}function onInput(e,b){if(e!==\"certNo\"||certTypeValueArray[currentIndex]===\"A\"){var d=getTag(e).value;if(d.match(inputVerify[e][\"regex\"])){inputVerify[e][\"lastValue\"]=d}else{if((e==\"certNo\"||e==\"bankMobile\")&&!isFirstInput[e]&&defaultValues[e]){var a=getFirtDifferent(defaultValues[e],getTag(e).value);d=a;if(a.match(inputVerify[e][\"regex\"])){inputVerify[e][\"lastValue\"]=a}}var c=d&&d[d.length-1];if(e==\"certNo\"&&c==\"x\"||c==\"X\"){toast(\"只能在最后一位输入字母X\",\"certNo\")}getTag(e).value=inputVerify[e][\"lastValue\"]}isFirstInput[e]=true;if(b){updateInputState(e,b)}}updateSubmitState()}var cvv2Regex=\"^\\\\d{3,4}$\";var validateRegex=\"^\\\\d{2}/\\\\d{2}$\";var phoneNoRegex=\"(^([+]?[0]{0,2}86|([+]?0{0,2}86-))?1\\\\d{10}$)|(^[+]?[0]{0,2}[1-9]{1}\\\\d{0,7}-\\\\d{7,11}$)\";var certNoRegex=\"(^\\\\d{15}$)|(^\\\\d{17}([0-9]|X|x)$)\";function updateInputState(a,c){var b=getTag(a);if(b&&b.value){hide(c)}else{show(c)}}function updateSubmitState(){var a=document.getElementsByTagName(\"input\");var c=false;for(var b=0;b<a.length;b++){if(a[b].disabled){continue}if(!a[b].value){c=true;break}if(a[b].id===\"cvv2\"&&!a[b].value.match(cvv2Regex)){c=true;break}if(a[b].id===\"validate\"&&!a[b].value.match(validateRegex)){c=true;break}}getTag(\"submit\").disabled=c;var d=getTag(\"cvv2\");if(d.value.length>=3){d.blur()}}function onSubmit(){amc.fn.hideKeyboard();var c={};if(rpc.isCredit){c.action={name:\"/card/sign\",neec:\"6004\",host:rpc.pci_url,https:true,enctype:\"application/x-www-form-urlencoded\",request_param:\"requestData\"}}else{c.action={name:\"/card/sign\",neec:\"6004\"}}c.action[\"loadtxt\"]=\"\";c.action[\"params\"]={cardtype:rpc.cardtype,bankcode:rpc.bankcode,ccdctoken:rpc.ccdctoken,hidden_card_no:rpc.hidden_card_no};c.param={};if(userNameDisplay){var i=getTag(\"userName\");if(i.value!==userNameDefault){c.param[\"username\"]=i.value}}var h=certTypeDefault;if(certTypeDisplay){var f=getTag(\"certType\");var h=certTypeValueArray[currentIndex];if(h!==certTypeDefault){c.param[\"certtype\"]=h}}if(certNoDisplay){var g=getTag(\"certNo\");if(g.value!==certNoDefault){if(h===\"A\"){var e=g.value;var b=e.match(certNoRegex);if(!b){document.toast({text:\"请输入正确的身份证号码\",type:\"fail\"},function(){g.focus()});return}}c.param[\"certno\"]=g.value}}if(bankMobileDisplay){var d=getTag(\"bankMobile\");if(d.value!==bankMobileDefault){var e=d.value;var b=e.match(phoneNoRegex);if(b==undefined){document.toast({text:\"大陆手机号为11位数字，非大陆手机号为“国家代码-手机号码”形式。\",type:\"fail\"},function(){d.focus()});return}c.param[\"bankmobile\"]=d.value}}if(rpc.cvv2){c.param[\"cvv2\"]=getTag(\"cvv2\").value}if(rpc.validate){var a=getTag(\"validate\").value||\"\";a=a.replace(\"/\",\"\");c.param[\"validate\"]=a||\"\"}document.asyncSubmit(c,function(j){amc.fn.shouldShowBtnIndicator(j,\"submit\",\"loading\")});amc.fn.shouldShowBtnIndicator({pageloading:\"1\"},\"submit\",\"loading\")}function onClickCvv(){showDialog(path+\"cvv\",\"安全码说明\",\"安全码是打印在信用卡背面签名区域的一组数字，一般是后3位或者4位数字。\")}function onClickValidate(){showDialog(path+\"validate\",\"有效期说明\",\"有效期是打印在信用卡正面卡号下方，标准格式为月份在前，年份在后的一串数字。\")}function onClickPhone(){showDialog(path+\"phone_info\",\"手机号说明\",\"银行预留的手机号是办理该银行卡时所填写的手机号码。\\n\\n没有预留、手机号忘记或者已停用，请联系银行客服更新处理。\")}function showDialog(a,c,b){getTag(\"dlgImg\").src=a;getTag(\"dlgTitle\").innerText=c;getTag(\"dlgText\").innerText=b;getTag(\"dlg\").showModal()}function onBack(){amc.fn.hideKeyboard();amc.fn.back()}function onKeyDown(){if(event.which==4){onBack()}};","tag":"text"}]},{"tag":"style","children":[{"text":".btn-orange {\n    background-color: #ff5500;\n    color: #fff;\n    height: 43px;\n    border: 0px;\n    font-size: 20px;\n    border-radius: 4px;\n    flex: 1.0\n}\n.btn-orange:active {\n    background-color: #e94900;\n    color: #fff;\n}\n.btn-orange:disabled {\n    background-color: #ff5500;\n    color: #ff9574;\n    flex: 1.0\n}\n.cell-margin-t {\n    margin-top: 20px;\n}","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"mainBody","tag":"div","children":[{"tag":"div","css":"amc-1px-line"},{"id":"cardNameArea","tag":"div","children":[{},{"id":"cardName","tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"卡类型","tag":"text"}],"css":"amc-cell-l-text amc-flex-1"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"bankName","tag":"label","css":"amc-cell-l-text"},{"id":"cardType","tag":"label","css":"amc-cell-l-text amc-margin-l"}],"css":"amc-cell-m-box"}],"css":"amc-cell amc-pd-lr"},{"tag":"div","css":"amc-1px-line"}],"css":"amc-v-box"},{"id":"cvv2AndValidate","tag":"div","children":[{"tag":"div","css":"amc-1px-line"},{},{"id":"cvvArea","tag":"div","children":[{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"安全码","tag":"text"}],"css":"amc-cell-l-text"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"cvv2","placeholder":"卡背面末三位数字","tag":"input","css":"amc-input","oninput":"onInput('cvv2', 'cvvInfoBox')"}],"css":"amc-cell-m-box"},{"id":"cvvInfoBox","tag":"div","children":[{"id":"cvvInfo","tag":"img","onclick":"onClickCvv()","css":"amc-info-img"}],"css":"amc-btn-img info-img"}],"css":"amc-cell amc-pd-lr"}],"css":"amc-bg-white amc-v-box"},{"id":"cvv2AndValidateLine","tag":"div","css":"amc-1px-line amc-margin-l"},{},{"id":"validateArea","tag":"div","children":[{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"有效期","tag":"text"}],"css":"amc-cell-l-text amc-flex-1"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"validate","placeholder":"月份/年份","tag":"input","type":"month","css":"amc-input","oninput":"onInput('validate', 'validateInfoBox')"}],"css":"amc-cell-m-box"},{"id":"validateInfoBox","tag":"div","children":[{"id":"validateInfo","tag":"img","onclick":"onClickValidate()","css":"amc-info-img"}],"css":"amc-btn-img info-img"}],"css":"amc-cell amc-pd-lr"}],"css":"amc-v-box amc-bg-white"},{"tag":"div","css":"amc-1px-line"}],"css":"amc-v-box cell-margin-t amc-bg-white"},{},{"id":"nameAndCertNo","tag":"div","children":[{"tag":"div","css":"amc-1px-line"},{},{"id":"userNameArea","tag":"div","children":[{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"姓名","tag":"text"}],"css":"amc-cell-l-text"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"userName","tag":"input","css":"amc-input","oninput":"updateSubmitState()"}],"css":"amc-cell-m-box"}],"css":"amc-cell amc-pd amc-flex-1"}],"css":"amc-v-box amc-bg-white"},{"id":"nameAndCertNoLine","tag":"div","css":"amc-1px-line amc-margin-l"},{},{"id":"certNoArea","tag":"div","children":[{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"证件号","tag":"text"}],"css":"amc-cell-l-text"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"certNo","placeholder":"","tag":"input","value":"","type":"NumbersAndPunctuation","css":"amc-input","oninput":"onInput('certNo')"}],"css":"amc-cell-m-box"}],"css":"amc-cell amc-pd-lr amc-flex-1"}],"css":"amc-v-box"},{"tag":"div","css":"amc-1px-line"}],"css":"amc-v-box cell-margin-t"},{},{"tag":"div","children":[{"tag":"label","children":[{"text":"信息加密处理，仅用于银行验证","tag":"text"}],"css":"amc-cell-footer-text"},{"id":"certTypeArea","tag":"div","children":[{"id":"certType","tag":"label","children":[{"text":"选择证件类型","tag":"text"}],"onclick":"onClickCertType();","css":"amc-font-m amc-text-right amc-theme-color"}],"css":"amc-flex-1 amc-justify-end amc-hidden"}],"css":"amc-pd-lr amc-margin-t-xs"},{"id":"bankMobileArea","tag":"div","children":[{"tag":"div","css":"amc-1px-line"},{},{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"手机号","tag":"text"}],"css":"amc-cell-l-text amc-flex-1"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"bankMobile","placeholder":"请输入银行预留手机号","tag":"input","value":"","type":"num","css":"amc-input","oninput":"onInput('bankMobile', 'bankMobileInfoBox');"}],"css":"amc-cell-m-box"},{"id":"bankMobileInfoBox","tag":"div","children":[{"id":"phoneInfo","tag":"img","onclick":"onClickPhone()","css":"amc-info-img"}],"css":"amc-btn-img info-img"}],"css":"amc-cell amc-pd-lr amc-flex-1"},{"tag":"div","css":"amc-1px-line"}],"css":"amc-v-box amc-margin-t"},{},{"tag":"div","children":[{"id":"agree","tag":"label","children":[{"text":"同意","tag":"text"}],"css":"amc-protocol-text amc-margin-r-s"},{"tag":"div","children":[{"id":"protocol","tag":"label","children":[{"text":"服务协议","tag":"text"}],"onclick":"showProtocol()","css":"amc-font-m amc-theme-color"}]}],"css":"amc-pd-lr amc-margin-t-xs"},{},{"tag":"div","children":[{"id":"btnBox","tag":"div","children":[{"id":"loading","tag":"img","src":"indicatior","css":"amc-loading-img amc-text-white-clolor amc-hidden"},{"id":"submit","tag":"button","children":[{"text":"下一步","tag":"text"}],"onclick":"onSubmit();","css":"amc-btn-primary amc-justify-center amc-align-center","disabled":"true"}],"css":"amc-btn-primary amc-justify-center amc-align-center"}],"css":"amc-pd"}],"css":"amc-main amc-scroll-android"},{"id":"dlg","tag":"dialog","children":[{"id":"dlgTitle","tag":"label","css":"amc-dlg-title"},{"tag":"div","children":[{"id":"dlgImg","tag":"img"}],"css":"amc-justify-center"},{"id":"dlgText","tag":"label","css":"amc-dlg-txt"},{"tag":"div","css":"amc-adapt-line amc-dlg-width"},{"tag":"button","children":[{"text":"知道了","tag":"text"}],"onclick":"getTag('dlg').close()","css":"amc-theme-color amc-dlg-btn"}],"css":"amc-dlg-box amc-v-box"}],"onkeydown":"onKeyDown();","css":"amc-body"}]},"format":"JSON","tplVersion":"5.1.2"}